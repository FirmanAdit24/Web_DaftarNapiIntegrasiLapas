<!doctype html>
<html lang="en" class="h-100">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Aplikasi Daftar Napi Berbasis Web">
  <meta name="author" content="FIKOM UMI">

  <!-- Title -->
  <title>Aplikasi Daftar Napi Lapas Kelas I Makassar</title>

  <!-- Favicon icon -->
  <link rel="shortcut icon" href="../../img/favicon.jpeg" type="image/x-icon">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway:100,200,300,400,500,600,700,800,900&amp;display=swap" rel="stylesheet">

  <!-- DataTables -->
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs5/dt-1.10.25/datatables.min.css" />

  <!-- Custom Style -->
  <link rel="stylesheet" href="../../style/style.css">
</head>

<body class="d-flex flex-column h-100">
  <header>
    <nav class="navbar navbar-expand-lg navbar-dark bg-success">
      <div class="container-fluid">
        <a class="navbar-brand" href="../index.html">
          <img src="../../img/logo.jpg" alt="Logo" height="45px">
        </a>
        <!-- Toggler button for mobile -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        
        <!-- Navbar links -->
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Beranda</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="napi-pengajuan.html">Napi Pengajuan Integrasi</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="#">Napi Proses Integrasi</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="napi-bebas.html">Napi yang Akan Bebas Integrasi</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </header>
  <main class="flex-shrink-0">
    <div class="container pt-4">
      <div class="d-flex flex-column flex-md-row px-4 py-3 mb-4 bg-white rounded-2 shadow-sm">
        <!-- judul halaman -->
        <div class="d-flex align-items-center me-md-auto">
          <i class="bi-people-fill text-success me-3 fs-3"></i>
          <h1 class="h5 pt-2">Input Data Narapidana Proses Integrasi</h1>
        </div>
      </div> 

      <div class="card border-0 shadow-sm">
        <div class="card-body p-4">
          <!-- Tabel Data Narapidana -->
          <div class="d-flex justify-content-between mb-3">
            <div>
              <label for="fileUpload" class="btn btn-secondary" id="customFIleUploadBtn">Pilih File Excel</label>
              <Label for="fileUpload" id="textFileExcel"></Label>
              <input type="file" id="fileUpload" style="display: none;" accept=".xlsx, .xls," />
              <button class="btn btn-primary" onclick="uploadExcel()" id="uploadExcelBtn" style="display: none;">Upload</button>
            </div>
            <button id="reset-data" class="btn btn-danger" type="button">Reset Data</button>
          </div>
          <div class="table-responsive mb-4">
            <table id="tabel-data-narapidana" class="table table-bordered table-striped table-hover">
              <thead>
                <tr>
                  <th colspan="4" style="text-align: center; background-color: #00aa9d; color: white;">Data Narapidana</th>
                </tr>
                <tr>
                  <th>No</th>
                  <th>Nama Narapidana</th>
                  <th>Keterangan</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody id="list-napi">
                <!-- Contoh data, ini bisa diisi dengan data yang sebenarnya -->
                <tr>
                  <td>-</td>
                  <td>-</td>
                  <td >-</td>
                  <td>
                    <button class="btn btn-primary btn-sm">-</button>
                    <button class="btn btn-danger btn-sm">-</button>
                  </td>
                </tr>
    
              </tbody>
            </table>
          </div>

          <!-- Tabel Input Data Narapidana -->
          <div class="table-responsive scrollable-table">
            <table id="tabel-input-narapidana" class="table table-bordered table-striped table-hover" width="100%">
              <!-- tabel input -->
              <thead>
                <tr>
                  <th colspan="3" style="text-align: center; background-color: #00aa9d; color: white;">Input Data Narapidana</th>
                </tr>
                <tr>
                  <th>Nama Narapidana</th>
                  <th>Keterangan</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody id="input-rows">
                <tr>
                  <td><input type="text" class="form-control" placeholder="Nama Narapidana" id="insertNama0"></td>
                  <td>
                    <select class="form-control" id="insertKet0">
            <option value="" disable selected hidden>Pilih Keterangan</option>

            
            <option value="Pengajuan Litmas">Pengajuan Litmas</option>
            <option value="Menunggu Hasil Litmas">Menunggu Hasil Litmas</option>
            <option value="Menunggu Sidang TPP">Menunggu Sidang TPP</option>
            <option value="Pengusulan Integrasi Ke Pusat">Pengusulan Integrasi Ke Pusat</option>
            <option value="Perbaikan Data">Perbaikan Data</option>
            <option value="Menunggu SK">Menunggu SK</option>
            <option value="SK Terbit">SK Terbit</option>
            <option value="Penundaan">Penundaan</option>
            
       
                    </select>
                  </td>
                  <!-- <td>
                    <button class="btn btn-danger btn-sm delete-row">Hapus</button>
                  </td> -->
                </tr>
              </tbody>
            </table>
          </div>
          <button id="add-row" class="btn btn-secondary mt-3" type="button">Tambah Baris</button>
          <button class="btn btn-success mt-3" type="button" id="insert-btn">Submit</button>
        </div>
      </div>
    </div>
  </main>

<!-- Modal Konfirmasi Reset -->
  <div class="modal fade" id="confirmResetModal" tabindex="-1" aria-labelledby="confirmResetModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmResetModalLabel">Konfirmasi Reset</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Apakah Anda yakin ingin mereset semua data? Tindakan ini tidak dapat dibatalkan!
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tidak</button>
          <button id="confirmResetBtn" type="button" class="btn btn-danger">Ya</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer mt-auto py-4">
    <div class="container-fluid">
      <!-- copyright -->
      <div class="copyright text-center mb-2 mb-md-0">
        &copy; 2024 - <a target="_blank" class="text-danger text-decoration-none">FIKOM UMI</a>. All rights reserved.
      </div>
    </div>
  </footer>

  <!-- jQuery Core -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <!-- Popper and Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.min.js" integrity="sha384-Atwg2Pkwv9vp0ygtn1JAojH0nYbwNJLPhwyoVbhoPwBhjQPR5VtM2+xf0Uwh9KtT" crossorigin="anonymous"></script>

  <!-- DataTables -->
  <script type="text/javascript" src="https://cdn.datatables.net/v/bs5/dt-1.10.25/datatables.min.js"></script>



  <script>
    let key = 0
    document.getElementById('add-row').addEventListener('click', function() {
      const table = document.getElementById('input-rows');
      const newRow = document.createElement('tr');
      key++
      newRow.innerHTML = `
        <td><input type="text" class="form-control" placeholder="Nama Narapidana" id="insertNama${key}" ></td>
        <td>
          <select class="form-control" id="insertKet${key}">
        <option value="" disable selected hidden>Pilih Keterangan</option>

            <option value="Pengajuan Litmas">Pengajuan Litmas</option>
            <option value="Menunggu Hasil Litmas">Menunggu Hasil Litmas</option>
            <option value="Menunggu Sidang TPP">Menunggu Sidang TPP</option>
            <option value="Pengusulan Integrasi Ke Pusat">Pengusulan Integrasi Ke Pusat</option>
            <option value="Perbaikan Data">Perbaikan Data</option>
            <option value="Menunggu SK">Menunggu SK</option>
            <option value="SK Terbit">SK Terbit</option>
            <option value="Penundaan">Penundaan</option>
          </select>
        </td>
        <td>
          <button class="btn btn-danger btn-sm delete-row">Hapus</button>
        </td>
      `;

      table.appendChild(newRow);

      // Attach delete event to new row
      newRow.querySelector('.delete-row').addEventListener('click', function() {
        table.removeChild(newRow);
      });
    });

    // Attach delete event to existing rows
    document.querySelectorAll('.delete-row').forEach(function(button) {
      button.addEventListener('click', function() {
        const row = button.closest('tr');
        row.parentNode.removeChild(row);
      });
    });
    
  </script>

<script src="FetchData.js"></script>  
<script src="NapiDiProsesScript.js" type="module"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app-compat.js"></script>
<script src="../firebase-config.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-database-compat.js"></script>


<!-- untuk menggunakan library yang dapat membaca file excel -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>

<script >

document.getElementById("fileUpload").addEventListener("change", (event)=>{
      console.log(event.target.files.length)
      if(event.target.files.length != 0){
        document.getElementById("textFileExcel").innerHTML = event.target.files[0].name
        document.getElementById("uploadExcelBtn").style.display = "inline"
      }else{
       document.getElementById("textFileExcel").innerHTML = ""
       document.getElementById("uploadExcelBtn").style.display = "none"
      }
    })

  function uploadExcel() {
var fileUpload = document.getElementById('fileUpload');
var file = fileUpload.files[0];
var reader = new FileReader();

reader.onload = function(e) {
  var data = new Uint8Array(e.target.result);
  var workbook = XLSX.read(data, { type: 'array' });
  
  // Ambil sheet pertama
  var firstSheet = workbook.Sheets[workbook.SheetNames[0]];
  
  // Konversi sheet ke JSON
  var excelData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
  
  console.log(excelData)

  if(excelData[0].length == 3){
    // Upload ke Firebase Realtime Database
    for(var i = 0; i < excelData.length-1 ; i++){
  
        firebase.database().ref('daftarStatusNapi/NapiDiProses').push().set({
            nama : excelData[i+1][1],
            ket: excelData[i+1][2],
        }
        , function(error) {
          if (error) {
            console.error('Gagal' + error);
          } else {
            console.log('Berhasil');
          }
        });
    }
    
  }else{
    alert("File Excel Anda tidak sesuai")
  }
};

reader.readAsArrayBuffer(file);
}

</script>
</body>
</html>
